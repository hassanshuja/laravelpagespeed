var br="https://www.meinweekend.ch/",disDays=[],enableDays=[],totalBookingPrice=0,lastTotalBookingPrice=0,activeOffer=0,bookingDate=0,stTime=0,endTime=0;function formatDate(e){return e.getDate()+"."+(e.getMonth()+1)+"."+e.getFullYear()}
function formatBookingDate(e){return["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"][e.getDay()]+", "+e.getDate()+". "+["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"][e.getMonth()]+" "+e.getFullYear()}
function formatVaucherDate(e){return e.getDate()+"."+("0"+(e.getMonth()+1)).slice(-2)+"."+e.getFullYear()}
function formatEnableDate(e){return("0"+(e.getDate()+1)).slice(-2)+"/"+("0"+(e.getMonth()+1)).slice(-2)+"/"+e.getFullYear()}
function formatEnableDate2(e){var t=("0"+e.getDate()).slice(-2);return("0"+(e.getMonth()+1)).slice(-2)+"/"+t+"/"+e.getFullYear()}
function disableDays(e){var t=formatDate(e),a=!1;$.inArray(t.toString(),enableDays);if(0<disDays.length)
for(var l=0;l<disDays.length;l++)return-1==$.inArray(t,disDays)||!!0;if(0<enableDays.length)
for(l=0;l<enableDays.length;l++){$.inArray(t.toString(),enableDays);if(-1!=$.inArray(t,enableDays)){a=!0;formatEnableDate(e);return!0}
return!1}
if(!0!==a){if(!(stTime<e&&e<endTime))return!1;calendarValid}}
function activateDateCalendar(){console.log("activateDae"),stTime=new Date(1e3*$("#stTime")[0].value),endTime=new Date(1e3*$("#endTime")[0].value),stFromDate=new Date(1e3*$("#defDate")[0].value);var e=parseInt($("#calendarValid")[0].value);$("#datetimepicker12").datepicker("destroy");var t=new Date,a=t.getDate(),l=t.getMonth()+1;if(a<10&&(a="0"+a),l<10&&(l="0"+l),(t=l+"/"+a+"/"+t.getFullYear())==formatEnableDate2(stFromDate)){var i=new Date(1e3*$("#defDate")[0].value);i.setDate(i.getDate()+1),stFromDate=i}
if(0==e){var r,n=$("#openedDates")[0].value.replace(/ /g,"").replace(/(?:\r\n|\r|\n)/g,""),o=JSON.parse(n);(enableDays=o)[0]&&(nDbB=o[0].split("."),newDate=nDbB[1]+"/"+nDbB[0]+"/"+nDbB[2],r=new Date(newDate)),r||(r=new Date),$("#datetimepicker12").datepicker({startDate:stFromDate,inline:!0,sideBySide:!0,format:"DD/MM/YYYY",language:"de",allowInputToggle:!0,beforeShowDay:disableDays}).on("changeDate",function(e){var t=formatBookingDate(e.date),a=formatDate(e.date),l=$("#userDatePickShow"),i=$("#userDatePickShow1"),r=$("#userDatePickShow2");l&&l.html(t),i&&i.html(t),r&&r.html(t),sendData={selDate:bookingDate=a},strSD=$.param(sendData),pData={step:2,pushD:strSD},navigateMasterData("reservation/"+activeOffer,{manualPushState:"reservation/"+activeOffer,type:"GET",data:pData})})}else{var c,s=$("#closedDates")[0].value.replace(/ /g,"").replace(/(?:\r\n|\r|\n)/g,""),d=JSON.parse(s),u=$("#availableDays")[0].value.replace(/ /g,"").replace(/(?:\r\n|\r|\n)/g,"");disDays=[],enableDays=[],c=0<(disDays=d).length?{inline:!0,startDate:stFromDate,endDate:endTime,sideBySide:!0,defaultDate:stFromDate,allowInputToggle:!0,daysOfWeekDisabled:u,format:"DD/MM/YYYY",language:"de",beforeShowDay:disableDays}:{inline:!0,startDate:stFromDate,endDate:endTime,sideBySide:!0,defaultDate:stFromDate,allowInputToggle:!0,daysOfWeekDisabled:u,format:"DD/MM/YYYY",language:"de"},$("#datetimepicker12").datepicker(c).on("changeDate",function(e){var t=formatBookingDate(e.date),a=formatDate(e.date),l=$("#userDatePickShow"),i=$("#userDatePickShow1"),r=$("#userDatePickShow2");l&&l.html(t),i&&i.html(t),r&&r.html(t),sendData={selDate:bookingDate=a},strSD=$.param(sendData),pData={step:2,pushD:strSD},navigateMasterData("reservation/"+activeOffer,{manualPushState:"reservation/"+activeOffer,type:"GET",data:pData})}),$("#datepicker").datepicker("setStartDate",stFromDate)}}
function navigateMasterData(e,t){var l=br+e+"?navigate=1";t&&t.gtype&&(l=br+e+"/"+t.gtype+"?navigate=1");var a=$.param(t.data);t.manualPushState&&window.history.pushState(null,null,br+t.manualPushState+"?"+a),$.ajax({url:l,type:t.type,context:document.body,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content"),allowNavigate:1},data:t.data}).done(function(e,t,a){a.getAllResponseHeaders();e.excUrl&&(trailUrl=e.excUrl.replace(br,""),lTrailUrl=trailUrl.replace("?navigate=1","")),e.view&&$("#pageDynamic").html(e.view),e.metaView&&($("head meta").remove(),$("head title").remove(),$("head").prepend(e.metaView)),$(this).addClass("done");-1!==l.indexOf("categoryType/weekend")?($(".wrapEr").removeClass("active"),$("#allWeekend .wrapEr").addClass("active")):-1!==l.indexOf("categoryType/Tagesausflug")?($(".wrapEr").removeClass("active"),$("#allTagesausflug .wrapEr").addClass("active")):-1!==l.indexOf("categoryType/Gruppenausflüge")&&($(".wrapEr").removeClass("active"),$("#allGruppenausfluge .wrapEr").addClass("active")),l.indexOf("geschenkgutschein")})}
function setOffer(e){lastTotalBookingPrice=totalBookingPrice=0,pricesSelected=[],aditionalSelected=[],activeOffer=e}
var pricesSelected=[],aditionalSelected=[];function selectPrice(e,t,a){var l=Number($("#s_curr").val()),i=Number($("#s_exch").val());currOption=e.target,0!=currOption.value?(singlePriceSelect={priceId:t,priceValue:currOption.value,totalPrice:a},selecP="#price_"+t,$(selecP+" option").filter(function(e){e==currOption.value?$(selecP+" option[value="+currOption.value+"]").attr("selected","selected"):$(selecP+" option[value="+e+"]").removeAttr("selected")}),0<pricesSelected.length&&pricesSelected.forEach(function(e,t){e.priceId==singlePriceSelect.priceId&&pricesSelected.splice(t,1)}),pricesSelected.push(singlePriceSelect),totalBill=0,pricesSelected.forEach(function(e,t){totalBill+=Number(e.totalPrice)*Number(e.priceValue)})):(selecP="#price_"+t,$(selecP+" option").filter(function(e){e==currOption.value?$(selecP+" option[value="+currOption.value+"]").attr("selected","selected"):$(selecP+" option[value="+e+"]").removeAttr("selected")}),singlePriceSelect={priceId:t,priceValue:currOption.value,totalPrice:a},pricesSelected.forEach(function(e,t){e.priceId==singlePriceSelect.priceId&&pricesSelected.splice(t,1)})),addUpBill(aditionalSelected,pricesSelected,l,i)}
function selectAditional(e,t,a){var l=Number($("#s_curr").val()),i=Number($("#s_exch").val());currOption=e.target,singlePriceSelect={additionalId:t,additionalValue:currOption.value,totalAdditional:a},selecP="#price_"+t,$(selecP+" option").filter(function(e){e==currOption.value?$(selecP+" option[value="+currOption.value+"]").attr("selected","selected"):$(selecP+" option[value="+e+"]").removeAttr("selected")}),0<aditionalSelected.length&&aditionalSelected.forEach(function(e,t){e.additionalId==singlePriceSelect.additionalId&&aditionalSelected.splice(t,1)}),aditionalSelected.push(singlePriceSelect),totalBillA=0,aditionalSelected.forEach(function(e,t){totalBillA+=Number(e.totalAdditional)*Number(e.additionalValue)}),addUpBill(aditionalSelected,pricesSelected,l,i)}
function addUpBill(e,t,a,l){(totalBillA=0)<e.length&&e.forEach(function(e,t){totalBillA+=Number(e.totalAdditional)*Number(e.additionalValue)}),0<t.length&&t.forEach(function(e,t){totalBillA+=Number(e.totalPrice)*Number(e.priceValue)}),0==a?($("#bookingTotal").text(totalBillA),rB=roundUp(totalBillA/l,0)):($("#bookingTotal").text(totalBillA),rB=roundUp(totalBillA*l,0)),$("#shiftBookingTotal").text(rB),0==e.length&&0==t.length?$("#selectedPricesInp").val(""):$("#selectedPricesInp").val("1")}
function startGroupReservation(e){navigateMaster("gruppenanfrage/"+activeOffer+"/"+e.target.value,{})}
function roundUp(e,t){return t=Math.pow(10,t),Math.ceil(e*t)/t}
function configurePrices(e){}
function selectPrices(e){$(".loadingStepStyle").addClass("forcedFlexNone"),sTable=$("#bookingTable").html();var t={_token:e,offer:activeOffer,prices:pricesSelected,additionals:aditionalSelected,firstTable:sTable};vauOffE=$("#vaucherOfferT1"),0<vauOffE.length&&(t.offerVaucherTable=vauOffE.html()),$.ajax({method:"POST",url:br+"selectedPrices",data:t,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}).done(function(e){$(".loadingStepStyle").removeClass("forcedFlexNone"),e?(e.table?($("#selectedPricesTable").html(e.table),$("#lastStepPrices").html(e.table)):($("#selectedPricesTable").html(""),$("#lastStepPrices").html("")),e.isAdditionalNight?$("#additionalNight").html(e.isAdditionalNight):$("#additionalNight").html("")):($("#selectedPricesTable").html(""),$("#lastStepPrices").html(""),$("#additionalNight").html(""))})}
function selectPricesOfferVaucher(e,t){$(".loadingStepStyle").addClass("forcedFlexNone"),sTable=$("#bookingTable").html();var a={_token:e,offer:activeOffer,prices:pricesSelected,additionals:aditionalSelected,firstTable:sTable};vauOffE=$("#vaucherOfferT1"),0<vauOffE.length&&(a.offerVaucherTable=vauOffE.html()),$.ajax({method:"POST",url:br+"selectedPrices",data:a}).done(function(e){console.log("submit"),$(".loadingStepStyle").removeClass("forcedFlexNone"),e?(navigateMaster("offerVaucherReservation/"+t+"?navigate=1&step=2",{manualPushState:"angebote/geschenkgutschein-geschenkidee/ideen/"+t+"?step=1"}),e.table?($("#selectedPricesTable").html(e.table),$("#lastStepPrices").html(e.table)):($("#selectedPricesTable").html(""),$("#lastStepPrices").html("")),e.isAdditionalNight?$("#additionalNight").html(e.isAdditionalNight):$("#additionalNight").html("")):($("#selectedPricesTable").html(""),$("#lastStepPrices").html(""),$("#additionalNight").html(""))})}
function getPrices(e){$.ajax({method:"GET",url:br+"pricesForDate/"+e+"/"+activeOffer}).done(function(e){$("#bookingTable").html(e)})}
$(document).ready(function(){$(document).on("change","#step2row input, #mainVaucherFormS1 input, #voucherStep2 input, #bookingVouchers1 input, #bookingVouchers2 input",function(e){var t=$(this);t.attr("value",t.val())}),$(document).on("change","#reservationgarantee_check",function(e){var t=$(this);"0"==t.attr("val")?t.attr("val","1"):t.attr("val","0")}),$(document).on("change","#step2row select, #voucherStep2 select, #bookingVouchers2 select",function(e){var a=$(this);"user_country"==this.id?$("#"+a.context.id+" option").filter(function(e){var t=1;++e==(t="Schweiz"==a.context.value?1:"Deutschland"==a.context.value?2:3)?$("#"+a.context.id+" option[cost="+t+"]").attr("selected","selected"):$("#"+a.context.id+" option[cost="+e+"]").removeAttr("selected")}):"user_payment"==this.id?(tT=this,$("#"+this.id+" option").filter(function(e){if(this.value==tT.value){if(console.log("this.value",this.value),"Kreditkarte/Postcard"==this.value){var t=$("#voucherStepb2Pay");console.log("chTypeRes.length",t.length),0<t.length&&$("#voucherStepb2").hide(),$("#voucherOffers3").hide(),$("#voucherStepb2Pay").show(),$("#voucherOffers3Pay").show()}else $("#voucherStepb2Pay").hide(),$("#voucherOffers3Pay").hide(),$("#voucherStepb2").show(),$("#voucherOffers3").show();$("#"+tT.id+' option[value="'+this.value+'"]').attr("selected","selected")}else $("#"+tT.id+' option[value="'+this.value+'"]').removeAttr("selected")})):"user_shipping"==this.id&&(tT=this,$("#"+this.id+" option").filter(function(e){this.value==tT.value?$("#"+tT.id+' option[value="'+this.value+'"]').attr("selected","selected"):$("#"+tT.id+' option[value="'+this.value+'"]').removeAttr("selected")}))});document.getElementById("datetimepicker12")}),$(document).ready(function(){})